# Deployment Guide: Convex + Vercel

## Prerequisites
- Node.js 18+ installed
- npm or yarn
- Git repository (for Vercel deployment)

## Step 1: Install Convex CLI

```bash
npm install -g convex
```

## Step 2: Set up Convex Backend

### Initialize Convex in your project
```bash
npx convex dev
```

This will:
1. Prompt you to log in (or create account) at https://convex.dev
2. Ask to create a new project or select existing
3. Create `.env.local` with your Convex credentials
4. Start the Convex dev server

### Deploy Convex functions
```bash
npx convex deploy
```

This deploys your Convex backend to production.

## Step 3: Environment Variables

Create a `.env.local` file if not already created:
```env
# Convex (auto-generated by convex dev)
NEXT_PUBLIC_CONVEX_URL=https://your-project.convex.cloud
CONVEX_DEPLOY_KEY=your-deploy-key

# Add any other env vars
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

## Step 4: Prepare for Vercel Deployment

### Install Vercel CLI (optional but recommended)
```bash
npm i -g vercel
```

### Add production environment variables to Vercel
You'll need to add these in Vercel dashboard or via CLI:
- `NEXT_PUBLIC_CONVEX_URL` - Your Convex production URL
- `CONVEX_DEPLOY_KEY` - Your Convex deploy key

## Step 5: Deploy to Vercel

### Option A: Via Vercel CLI (Recommended)
```bash
# First deployment
vercel

# Follow prompts to:
# - Link to your Vercel account
# - Set up project
# - Configure build settings

# Future deployments
vercel --prod
```

### Option B: Via Git Integration
1. Push your code to GitHub/GitLab/Bitbucket
2. Go to https://vercel.com/new
3. Import your repository
4. Configure:
   - Framework Preset: Next.js
   - Root Directory: ./
   - Build Command: `npm run build` (default)
   - Output Directory: .next (default)
5. Add environment variables
6. Deploy

## Step 6: Post-Deployment Setup

### Configure Convex for Production
In your Convex dashboard:
1. Go to Settings â†’ Environment Variables
2. Add any production-specific variables
3. Update CORS settings if needed

### Update your app URLs
In `.env.production`:
```env
NEXT_PUBLIC_APP_URL=https://your-app.vercel.app
```

## Complete Deployment Commands Summary

```bash
# 1. Install dependencies
npm install

# 2. Set up Convex
npx convex dev

# 3. Deploy Convex backend
npx convex deploy

# 4. Deploy to Vercel
vercel --prod
```

## Troubleshooting

### Convex Issues
- **"No Convex project found"**: Run `npx convex dev` first
- **Functions not deploying**: Check `convex/` folder exists and has `.ts` files
- **Auth errors**: Verify environment variables are set in Vercel

### Vercel Issues
- **Build failures**: Check Node version (specify in `package.json` engines)
- **500 errors**: Check Vercel function logs
- **Environment variables**: Ensure all `NEXT_PUBLIC_` vars are set

### Quick Fix Script
Add to `package.json`:
```json
{
  "scripts": {
    "deploy": "convex deploy && vercel --prod",
    "setup": "npm install && npx convex dev"
  }
}
```

## Monitoring

### Convex Dashboard
- View logs: https://dashboard.convex.dev
- Monitor functions
- Check data usage

### Vercel Dashboard  
- View deployments: https://vercel.com/dashboard
- Check function logs
- Monitor performance

## Security Checklist
- [ ] Environment variables set in Vercel
- [ ] Convex security rules configured
- [ ] CORS settings appropriate for production
- [ ] API rate limiting enabled
- [ ] Error tracking set up (e.g., Sentry)

## Cost Optimization
- Convex: Free tier includes 1M function calls/month
- Vercel: Free tier includes 100GB bandwidth/month
- Monitor usage in both dashboards

That's it! Your app should now be live at your Vercel URL with Convex backend connected.